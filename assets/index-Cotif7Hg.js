(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const y of a.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&n(y)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}})();class w{_events;constructor(){this._events=new Map}on(t,e){this._events.has(t)||this._events.set(t,new Set),this._events.get(t)?.add(e)}off(t,e){this._events.has(t)&&(this._events.get(t).delete(e),this._events.get(t)?.size===0&&this._events.delete(t))}emit(t,e){this._events.forEach((n,o)=>{o==="*"&&n.forEach(a=>a({eventName:t,data:e})),(o instanceof RegExp&&o.test(t)||o===t)&&n.forEach(a=>a(e))})}onAll(t){this.on("*",t)}offAll(){this._events=new Map}trigger(t,e){return(n={})=>{this.emit(t,{...n||{},...e||{}})}}}class x{constructor(t){this.events=t}productShopList=[];addProductToBasket(t){this.productShopList.push(t),this.events.emit("basket:change")}removeProductFromBasket(t){this.productShopList=this.productShopList.filter(e=>e.id!==t.id),this.events.emit("basket:change")}getProductToBasket(){return this.productShopList}clearBasket(){this.productShopList=[],this.events.emit("basket:change")}getSumProductToBasket(){return this.productShopList.reduce((t,e)=>t+(e.price||0),0)}getCountProductToBasket(){return this.productShopList.length}isProductInBasket(t){return this.productShopList.some(e=>e.id===t)}}class S{constructor(t){this.events=t}buyerData={payment:null,email:"",phone:"",address:""};saveBuyerData(t){this.buyerData||(this.buyerData={payment:null,email:"",phone:"",address:""}),Object.assign(this.buyerData,t),this.events.emit("buyer:change")}getBuyerData(){return this.buyerData}clearBuyerData(){this.buyerData={payment:null,email:"",phone:"",address:""},this.events.emit("buyer:change")}isValidData(){const t={};return this.buyerData?(this.buyerData.payment||(t.payment="Не указан способ оплаты"),this.buyerData.email||(t.email="Необходимо указать адресс электронной почты"),this.buyerData.phone||(t.phone="Необходимо указать номер телефона"),this.buyerData.address||(t.address="Необходимо указать адрес"),t):(t.payment="Не указан способ оплаты",t.email="Необходимо указать адресс электронной почты",t.phone="Необходимо указать номер телефона",t.address="Необходимо указать адрес",t)}}class D{baseUrl;options;constructor(t,e={}){this.baseUrl=t,this.options={headers:{"Content-Type":"application/json",...e.headers??{}}}}handleResponse(t){return t.ok?t.json():t.json().then(e=>Promise.reject(e.error??t.statusText))}get(t){return fetch(this.baseUrl+t,{...this.options,method:"GET"}).then(this.handleResponse)}post(t,e,n="POST"){return fetch(this.baseUrl+t,{...this.options,method:n,body:JSON.stringify(e)}).then(this.handleResponse)}}class T extends D{constructor(t,e={}){super(t,e)}getProductList(){return this.get("/product/")}postData(t){return this.post("/order/",t)}}class O{constructor(t){this.events=t}productsList=[];choosenProduct=null;saveProductsList(t){this.productsList=t,this.events.emit("catalog:change")}getProductsList(){return this.productsList}getProductById(t){return this.productsList.find(e=>e.id===t)}saveChoosenProduct(t){this.choosenProduct=this.productsList.filter(e=>e.id===t)[0],this.events.emit("card:choose")}getChoosenProduct(){return this.choosenProduct}}function B(s){return typeof s=="string"&&s.length>1}function M(s,t=document){if(B(s))return Array.from(t.querySelectorAll(s));if(s instanceof NodeList)return Array.from(s);if(Array.isArray(s))return s;throw new Error("Unknown selector element")}function r(s,t){if(B(s)){const e=M(s,t);if(e.length>1&&console.warn(`selector ${s} return more then one element`),e.length===0)throw new Error(`selector ${s} return nothing`);return e.pop()}if(s instanceof HTMLElement)return s;throw new Error("Unknown selector element")}function h(s){const t=r(s);if(!t.content.firstElementChild)throw new Error(`Template ${s} has no content`);return t.content.firstElementChild.cloneNode(!0)}class u{constructor(t){this.container=t}setImage(t,e,n){t&&(t.src=e,n&&(t.alt=n))}render(t){return Object.assign(this,t??{}),this.container}}class $ extends u{constructor(t,e){super(t),this.events=e,this.basketButton=r(".basket__button",this.container),this.basketContainer=r(".basket__list",this.container),this.totalPrice=r(".basket__price",this.container),this.basketButton.addEventListener("click",()=>{this.events.emit("basket:success")})}basketButton;basketContainer;totalPrice;set total(t){this.totalPrice.textContent=`${t} синапсов`}set basket(t){if(t.length===0){const e=document.createElement("P");e.textContent="Корзина пуста",this.basketContainer.replaceChildren(e),this.basketButton.disabled=!0}else this.basketContainer.replaceChildren(...t),this.basketButton.disabled=!1}set buttonStatus(t){this.basketButton.disabled=t}}class k extends u{cardTitle;cardPrice;CardId;constructor(t){super(t),this.cardTitle=r(".card__title",this.container),this.cardPrice=r(".card__price",this.container)}set id(t){this.CardId=t}set title(t){this.cardTitle.textContent=t}set price(t){t===null?this.cardPrice.textContent="Бесценно":this.cardPrice.textContent=`${t} синапсов`}}class C extends k{constructor(t,e){super(t),this.events=e,this.cardIndex=r(".basket__item-index",this.container),this.cardButtonRemove=r(".basket__item-delete",this.container),this.cardButtonRemove.addEventListener("click",()=>{this.events.emit("card__basket:remove",{id:this.CardId})})}cardIndex;cardButtonRemove;set index(t){this.cardIndex.textContent=String(t)}}const A="https://larek-api.nomoreparties.co/api/weblarek",P="https://larek-api.nomoreparties.co/content/weblarek",f={"софт-скил":"card__category_soft","хард-скил":"card__category_hard",кнопка:"card__category_button",дополнительное:"card__category_additional",другое:"card__category_other"};class R extends k{constructor(t,e){super(t),this.events=e,this.cardCategory=r(".card__category",this.container),this.cardImage=r(".card__image",this.container),this.container.addEventListener("click",()=>{this.events.emit("card:click",{id:this.CardId})})}cardCategory;cardImage;set image(t){this.cardImage.src=`${P}/${t}`,this.cardImage.alt=this.title}set category(t){this.cardCategory.textContent=t;for(const e in f)this.cardCategory.classList.toggle(f[e],e===t)}}class j extends k{constructor(t,e){super(t),this.events=e,this.cardImage=r(".card__image",this.container),this.cardCategory=r(".card__category",this.container),this.cardDescription=r(".card__text",this.container),this.cardButton=r(".card__button",this.container),this.cardButton.addEventListener("click",()=>{this.events.emit("card__preview:click")})}cardImage;cardCategory;cardDescription;cardButton;set image(t){this.cardImage.src=`${P}/${t}`,this.cardImage.alt=this.title}set category(t){this.cardCategory.textContent=t;for(const e in f)this.cardCategory.classList.toggle(f[e],e===t)}set description(t){this.cardDescription.textContent=t}set buttonText(t){this.cardButton.textContent=String(t),this.cardButton.disabled=!1,t==="Недоступно"&&(this.cardButton.disabled=!0)}}class L extends u{constructor(t,e){super(t),this.events=e,this.formError=r(".form__errors",this.container),this.formButton=r(".modal__actions button",this.container),this.container.addEventListener("submit",n=>{n.preventDefault(),this.events.emit(`${this.container.getAttribute("name")}:submit`)})}formError;formButton;set error(t){this.formError.textContent=t}set buttonStatus(t){this.formButton.disabled=t}onInputChange(t,e){this.events.emit("form:change",{field:t,value:e})}}class U extends L{constructor(t,e){super(t,e),this.events=e,this.emailInput=r('input[name="email"]',this.container),this.phoneInput=r('input[name="phone"]',this.container),this.emailInput.addEventListener("input",()=>{const n="email",o=this.emailInput.value;this.onInputChange(n,o)}),this.phoneInput.addEventListener("input",()=>{const n="phone",o=this.phoneInput.value;this.onInputChange(n,o)})}emailInput;phoneInput;set email(t){this.emailInput.value=t}set phone(t){this.phoneInput.value=t}}class F extends u{constructor(t){super(t)}set catalog(t){this.container.replaceChildren(...t)}}class G extends u{constructor(t,e){super(t),this.events=e,this.basketButton=r(".header__basket",this.container),this.counterElement=r(".header__basket-counter",this.container),this.basketButton.addEventListener("click",()=>{this.events.emit("basket:open")})}basketButton;counterElement;set counter(t){this.counterElement.textContent=String(t)}}class H extends u{constructor(t,e){super(t),this.events=e,this.modalElement=r(".modal__content",this.container),this.closeButton=r(".modal__close",this.container),this.closeButton.addEventListener("click",()=>{this.closeModal(),this.events.emit("modal:close")}),document.addEventListener("keydown",n=>{this.container.classList.contains("modal_active")&&n.key==="Escape"&&(this.closeModal(),this.events.emit("modal:close"))}),this.closeButton.addEventListener("click",this.closeModal.bind(this)),this.container.addEventListener("click",this.closeModal.bind(this)),this.modalElement.addEventListener("click",n=>n.stopPropagation())}modalElement;closeButton;set content(t){this.modalElement.replaceChildren(t)}openModal(){this.container.classList.add("modal_active")}closeModal(){this.container.classList.remove("modal_active")}}class V extends L{constructor(t,e){super(t,e),this.events=e,this.buttonPaymentOnline=r('button[name="card"]',this.container),this.buttonPaymentOffline=r('button[name="cash"]',this.container),this.adressInput=r('input[name="address"]',this.container),this.buttonPaymentOnline.addEventListener("click",()=>{this.onInputChange("payment","card")}),this.buttonPaymentOffline.addEventListener("click",()=>{this.onInputChange("payment","cash")}),this.adressInput.addEventListener("input",()=>{const n="address",o=this.adressInput.value;this.onInputChange(n,o)})}buttonPaymentOnline;buttonPaymentOffline;adressInput;set payment(t){this.buttonPaymentOnline.classList.toggle("button_alt-active",t==="card"),this.buttonPaymentOffline.classList.toggle("button_alt-active",t==="cash")}set address(t){this.adressInput.value=t}}class q extends u{constructor(t,e){super(t),this.events=e,this.successElement=r(".order-success__description",this.container),this.successButton=r(".order-success__close",this.container),this.successButton.addEventListener("click",()=>{this.events.emit("success:agree")})}successElement;successButton;set total(t){this.successElement.textContent=`Списано ${t} синапсов`}}const I=new T(A),i=new w,m=new O(i),z=new F(r(".gallery")),d=new H(r("#modal-container"),i),c=new x(i),E=new G(r(".header"),i),g=new $(h("#basket"),i),b=new S(i),l=new V(h("#order"),i),p=new U(h("#contacts"),i),v=new q(h("#success"),i),_=new j(h("#card-preview"),i);I.getProductList().then(s=>{console.log("Данные получены"),m.saveProductsList(s.items)}).catch(s=>{console.error(s)});i.on("catalog:change",()=>{const s=m.getProductsList().map(t=>new R(h("#card-catalog"),i).render(t));z.render({catalog:s})});i.on("card:click",s=>{m.saveChoosenProduct(s.id)});i.on("card:choose",()=>{const s=m.getChoosenProduct();if(!s)return;let t="";s.price===null?t="Недоступно":t=c.isProductInBasket(s.id)?"Удалить из корзины":"Купить",_.buttonText=t,d.openModal(),d.render({content:_.render(s)})});i.on("card__preview:click",()=>{const s=m.getChoosenProduct();s&&(c.isProductInBasket(s.id)?c.removeProductFromBasket(s):c.addProductToBasket(s),d.closeModal())});i.on("basket:open",()=>{E.counter=c.getCountProductToBasket();const s=c.getProductToBasket().map((t,e)=>{const n=new C(h("#card-basket"),i);return n.index=e+1,n.title=t.title,n.price=t.price,n.render(t)});g.basket=s,g.total=c.getSumProductToBasket(),d.openModal(),d.render({content:g.render()})});i.on("card__basket:remove",s=>{const t=m.getProductById(s.id);t&&c.removeProductFromBasket(t)});i.on("basket:change",()=>{E.counter=c.getCountProductToBasket();const s=c.getProductToBasket().map((t,e)=>{const n=new C(h("#card-basket"),i);return n.index=e+1,n.title=t.title,n.price=t.price,n.render(t)});g.basket=s,g.total=c.getSumProductToBasket()});i.on("basket:success",()=>{l.error="",d.render({content:l.render()})});i.on("form:change",s=>{b.saveBuyerData({[s.field]:s.value})});i.on("buyer:change",()=>{const s=b.isValidData(),t=b.getBuyerData();t&&(l.payment=t.payment||null,l.address=t.address||"",p.email=t.email||"",p.phone=t.phone||"");const e=[];s.payment&&e.push(s.payment),s.address&&e.push(s.address),l.error=e.join(", "),l.buttonStatus=e.length>0;const n=[];s.email&&n.push(s.email),s.phone&&n.push(s.phone),p.error=n.join(", "),p.buttonStatus=n.length>0});i.on("order:submit",()=>{p.error="",d.render({content:p.render()})});i.on("contacts:submit",()=>{const t={...b.getBuyerData(),total:c.getSumProductToBasket(),items:c.getProductToBasket().map(e=>e.id)};I.postData(t).then(()=>{c.clearBasket(),v.total=t.total}).catch(e=>console.log("Error",e)),d.render({content:v.render()})});i.on("success:agree",()=>{d.closeModal()});
